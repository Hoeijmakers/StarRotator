#include "spectrum.h"
#include <math.h>
#include <errno.h>
#include <stdio.h>
double partfn(double code,double T,double Ne);
int approx();

void pfinit(V,atom,model,flagw)
pfunc *V;
atominfo *atom;
atmosphere *model;
int flagw;
{
  int i,j;
  extern int Ntau;
  static double species[TNATOM] = 
   { 1.0, 2.0, 2.1, 2.2, 3.0, 3.1, 3.2, 4.0, 4.1, 4.2, 5.0, 5.1, 5.2, 6.0, 
     6.1, 6.2, 6.3, 6.4, 7.0, 7.1, 7.2, 7.3, 7.4, 8.0, 8.1, 8.2, 8.3, 8.4, 
     9.0, 9.1, 9.2,10.0,10.1,10.2,11.0,11.1,11.2,11.3,11.4,12.0,12.1,12.2,
    12.3,12.4,13.0,13.1,13.2,13.3,13.4,14.0,14.1,14.2,14.3,14.4,15.0,15.1,
    15.2,15.3,16.0,16.1,16.2,16.3,16.4,17.0,17.1,17.2,18.0,18.1,18.2,19.0,
    19.1,19.2,19.3,19.4,20.0,20.1,20.2,20.3,20.4,21.0,21.1,21.2,21.3,22.0,
    22.1,22.2,22.3,23.0,23.1,23.2,23.3,24.0,24.1,24.2,24.3,25.0,25.1,25.2,
    25.3,26.0,26.1,26.2,26.3,26.4,27.0,27.1,27.2,27.3,28.0,28.1,28.2,28.3,
    29.0,29.1,29.2,29.3,30.0,30.1,30.2,30.3,31.0,31.1,31.2,31.3,32.0,32.1,
    32.2,32.3,33.0,33.1,33.2,34.0,34.1,34.2,35.0,35.1,35.2,36.0,36.1,36.2,
    37.0,37.1,37.2,38.0,38.1,38.2,39.0,39.1,39.2,40.0,40.1,40.2,41.0,41.1,
    41.2,42.0,42.1,42.2,43.0,43.1,43.2,44.0,44.1,44.2,45.0,45.1,45.2,46.0,
    46.1,46.2,47.0,47.1,47.2,48.0,48.1,48.2,49.0,49.1,49.2,50.0,50.1,50.2,
    51.0,51.1,51.2,52.0,52.1,52.2,53.0,53.1,53.2,54.0,54.1,54.2,55.0,55.1,
    55.2,56.0,56.1,56.2,57.0,57.1,57.2,58.0,58.1,58.2,59.0,59.1,59.2,60.0,
    60.1,60.2,61.0,61.1,61.2,62.0,62.1,62.2,63.0,63.1,63.2,64.0,64.1,64.2,
    65.0,65.1,65.2,66.0,66.1,66.2,67.0,67.1,67.2,68.0,68.1,68.2,69.0,69.1,
    69.2,70.0,70.1,70.2,71.0,71.1,71.2,72.0,72.1,72.2,73.0,73.1,73.2,74.0,
    74.1,74.2,75.0,75.1,75.2,76.0,76.1,76.2,77.0,77.1,77.2,78.0,78.1,78.2,
    79.0,79.1,79.2,80.0,80.1,80.2,81.0,81.1,81.2,82.0,82.1,82.2,83.0,83.1,
    83.2,84.0,84.1,84.2,85.0,85.1,85.2,86.0,86.1,86.2,87.0,87.1,87.2,88.0,
    88.1,88.2,89.0,89.1,89.2,90.0,90.1,90.2,91.0,91.1,91.2,92.0,92.1,92.2};

  if(flagw == 1) {
    printf("Calculating Partition Functions for all species for all levels\n");
    printf("Completed level ");
  }
  for(i=0;i<TNATOM;i++) V->species[i] = species[i];

  for(j=0;j<Ntau;j++) {
    for(i=0;i<TNATOM;i++) 
      V->pf[i][j] = partfn(V->species[i],model->T[j],model->Ne[j]);
    if(flagw == 1) printf("%d  ",j);
  }
  if(flagw == 1) printf("\n");
}

