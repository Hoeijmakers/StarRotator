#include <stdio.h>
#include <math.h>
void linter(double *xold, double *yold, int nold, double xnew, double *ynew);


double hminffop(double nu,double T)
{
  static double wavek[22] = {.50,.40,.35,.30,.25,.20,.18,.16,.14,.12,.10,.09,
                             .08,.07,.06,.05,.04,.03,.02,.01,.008,.006};
  static double thetaff[11] = {0.5,  0.6, 0.8,  1.0,  1.2,  1.4,  1.6,  1.8,
                               2.0,  2.8,  3.6};

  static double ff[22][11] =
    {{.0178,.0222,.0308,.0402,.0498,.0596,.0695,.0795,.0896, .131, .172},
     {.0228,.0280,.0388,.0499,.0614,.0732,.0851,.0972, .110, .160, .211},
     {.0277,.0342,.0476,.0615,.0760,.0908, .105, .121, .136, .199, .262},
     {.0364,.0447,.0616,.0789,.0966, .114, .132, .150, .169, .243, .318},
     {.0520,.0633,.0859, .108, .131, .154, .178, .201, .225, .321, .418},
     {.0791,.0959, .129, .161, .194, .227, .260, .293, .327, .463, .602},
     {.0965, .117, .157, .195, .234, .272, .311, .351, .390, .549, .711},
     {.121, .146, .195, .241, .288, .334, .381, .428, .475, .667, .861},
     {.154, .188, .249, .309, .367, .424, .482, .539, .597, .830, 1.07},
     {.208, .250, .332, .409, .484, .557, .630, .702, .774, 1.06, 1.36},
     {.293, .354, .468, .576, .677, .777, .874, .969, 1.06, 1.45, 1.83},
     {.358, .432, .572, .702, .825, .943, 1.06, 1.17, 1.28, 1.73, 2.17},
     {.448, .539, .711, .871, 1.02, 1.16, 1.29, 1.43, 1.57, 2.09, 2.60},
     {.579, .699, .924, 1.13, 1.33, 1.51, 1.69, 1.86, 2.02, 2.67, 3.31},
     {.781, .940, 1.24, 1.52, 1.78, 2.02, 2.26, 2.48, 2.69, 3.52, 4.31},
     {1.11, 1.34, 1.77, 2.17, 2.53, 2.87, 3.20, 3.51, 3.80, 4.92, 5.97},
     {1.73, 2.08, 2.74, 3.37, 3.90, 4.50, 5.01, 5.50, 5.95, 7.59, 9.06},
     {3.04, 3.65, 4.80, 5.86, 6.86, 7.79, 8.67, 9.50, 10.3, 13.2, 15.6},
     {6.79, 8.16, 10.7, 13.1, 15.3, 17.4, 19.4, 21.2, 23.0, 29.5, 35.0},
     {27.0, 32.4, 42.6, 51.9, 60.7, 68.9, 76.8, 84.2, 91.4, 117., 140.},
     {42.3, 50.6, 66.4, 80.8, 94.5, 107., 120., 131., 142., 183., 219.},
     {75.1, 90.0, 118., 144., 168., 191., 212., 234., 253., 325., 388.}};

  static double wfflog[22],fflog[22][11];
  double fftt[11];
  double theta,wavelog,hminff,fftlog;
  static double c = 2.99792458e+18;
  static int flag = 0;
  int i,j;


  if(flag == 0) {
    for(i=0;i<22;i++) {
      wfflog[i] = log(91.134/wavek[i]);
      for(j=0;j<11;i++) fflog[i][j] = log(ff[i][j]*1.0e-26);
    }
    flag = 1;
  }

  theta = 5040.0/T;
  wavelog = log(c/nu);
  for(i=0;i<11;i++) {
    linter(wfflog,fflog[i],22,wavelog,&fftlog);
    fftt[i] = exp(fftlog)/thetaff[i]*5040*1.380658e-16;
  }
  linter(thetaff,fftt,11,theta,&hminff);
  hminff *= 1.0e-18;
  /* Does not include stimulated emission */
  return(hminff);

}

void linter(double *xold, double *yold, int nold, double xnew, double *ynew)
{
  int iold,i,j;

  for(i=0;i<iold;i++) {
    if(xnew >= xold[i]) {
      j = i;
      break;
    }
  }
  *ynew = yold[j] + (yold[j+1]-yold[j])/(xold[j+1]-xold[j])*(xnew-xold[j]);
  return;
} 
