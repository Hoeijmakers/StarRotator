#include <math.h>
#include <errno.h>
#include "spectrum.h"
double partfn(double code,double T,double Ne);
void search(float xx[], int n, float x, int *jlo);

double ca1op_av(double nu,atmosphere *model,int k)
{

  double hckt,A,H,waveno,x,u,Ryd,ryd,xsect,tkev;
  int j;

  static float x1[52] =
    {4.228159e-01,4.279555e-01,4.312202e-01,4.345548e-01,4.379252e-01,
4.442633e-01,4.472451e-01,4.501106e-01,4.515017e-01,4.528659e-01,
4.542040e-01,4.555166e-01,4.568043e-01,4.593077e-01,4.617189e-01,
4.725399e-01,4.744832e-01,4.799294e-01,4.832679e-01,4.893297e-01,
5.108264e-01,5.272285e-01,5.348678e-01,5.467632e-01,5.701101e-01,
5.824566e-01,5.988783e-01,6.231566e-01,6.537325e-01,7.034872e-01,
7.631192e-01,8.227513e-01,9.221380e-01,1.021525e+00,1.120911e+00,
1.240175e+00,1.438949e+00,1.637722e+00,2.234043e+00,2.432816e+00,
2.742991e+00,2.912607e+00,3.092713e+00,3.283956e+00,3.487026e+00,
3.702650e+00,3.931611e+00,4.174728e+00,4.432878e+00,4.613787e+00,
     4.802080e+00,4.899089e+00};

  static float y1[52] = 
  {1.866e+01,1.182e+01,5.047e+00,4.834e+00,4.440e+00,
3.559e+00,3.246e+00,3.095e+00,3.086e+00,3.124e+00,
3.207e+00,3.333e+00,3.499e+00,3.935e+00,4.478e+00,
7.406e+00,7.834e+00,8.636e+00,8.828e+00,8.736e+00,
6.605e+00,3.920e+00,3.086e+00,2.584e+00,2.666e+00,
2.565e+00,2.239e+00,1.886e+00,1.547e+00,1.170e+00,
8.663e-01,6.727e-01,4.805e-01,3.502e-01,2.675e-01,
2.117e-01,1.594e-01,1.326e-01,9.937e-02,9.070e-02,
6.536e-02,5.460e-02,4.560e-02,3.809e-02,3.182e-02,
2.657e-02,2.220e-02,1.854e-02,1.547e-02,1.371e-02,
   1.207e-02,1.137e-02};

  static float x2[38] =
    {2.991679e-01,3.009146e-01,3.026275e-01,3.075722e-01,3.109068e-01,
3.175110e-01,3.278537e-01,3.318686e-01,3.437244e-01,3.656817e-01,
3.774153e-01,3.920050e-01,3.969839e-01,4.051970e-01,4.238899e-01,
4.283373e-01,4.338899e-01,4.475950e-01,4.732067e-01,4.856453e-01,
5.300845e-01,5.997166e-01,6.792259e-01,7.587353e-01,8.382447e-01,
9.177540e-01,1.017141e+00,1.116527e+00,1.215914e+00,1.335178e+00,
1.474320e+00,1.653216e+00,1.891744e+00,2.130272e+00,2.451958e+00,
     2.603579e+00,2.820424e+00,2.877399e+00};

  static float y2[38] = 
  {3.006e+00,2.133e+00,6.768e+00,9.917e+00,1.179e+01,
1.436e+01,1.581e+01,1.595e+01,1.547e+01,1.241e+01,
1.217e+01,1.164e+01,1.160e+01,1.212e+01,1.537e+01,
1.540e+01,1.462e+01,1.100e+01,8.892e+00,8.611e+00,
6.757e+00,4.881e+00,3.387e+00,2.370e+00,1.711e+00,
1.274e+00,9.079e-01,6.610e-01,4.958e-01,3.670e-01,
2.740e-01,2.031e-01,1.460e-01,1.097e-01,7.651e-02,
   6.392e-02,4.999e-02,4.708e-02};

  static float x3[47] =
  {2.132875e-01,2.200751e-01,2.300303e-01,2.459882e-01,2.497794e-01,
2.521906e-01,2.533630e-01,2.556443e-01,2.578440e-01,2.630115e-01,
2.677472e-01,2.695312e-01,2.737395e-01,2.776182e-01,2.851502e-01,
2.863890e-01,2.893306e-01,3.084197e-01,3.247847e-01,3.438827e-01,
3.480095e-01,3.507189e-01,3.558354e-01,3.719955e-01,3.782050e-01,
3.837367e-01,4.442041e-01,4.939588e-01,5.734682e-01,6.927322e-01,
7.921190e-01,9.113830e-01,1.090279e+00,1.249298e+00,1.467949e+00,
1.785986e+00,2.457113e+00,2.609051e+00,2.770386e+00,2.941697e+00,
3.123601e+00,3.316755e+00,3.521852e+00,3.739631e+00,3.970877e+00,
   4.132931e+00,4.216421e+00};

  static float y3[47] =
  {4.524e+01,3.665e+01,3.067e+01,2.182e+01,2.014e+01,
1.990e+01,2.009e+01,2.108e+01,2.271e+01,2.766e+01,
3.065e+01,3.094e+01,2.985e+01,2.733e+01,2.216e+01,
2.158e+01,2.065e+01,2.027e+01,1.947e+01,2.354e+01,
2.381e+01,2.366e+01,2.284e+01,1.946e+01,1.849e+01,
1.786e+01,1.309e+01,1.050e+01,7.951e+00,5.527e+00,
4.152e+00,3.144e+00,2.242e+00,1.738e+00,1.339e+00,
9.778e-01,5.114e-01,4.271e-01,3.568e-01,2.980e-01,
2.489e-01,2.079e-01,1.737e-01,1.450e-01,1.211e-01,
   1.068e-01,1.006e-01};

  static float x4[67] =
    {2.131331e-01,2.148797e-01,2.165926e-01,2.215374e-01,2.231331e-01,
2.248719e-01,2.265747e-01,2.282424e-01,2.314761e-01,2.330440e-01,
2.345804e-01,2.360862e-01,2.390091e-01,2.404278e-01,2.418189e-01,
2.431831e-01,2.458338e-01,2.471215e-01,2.483850e-01,2.496249e-01,
2.520361e-01,2.554898e-01,2.608447e-01,2.648003e-01,2.666777e-01,
2.675927e-01,2.711020e-01,2.743860e-01,2.824031e-01,2.843622e-01,
3.056261e-01,3.189672e-01,3.202911e-01,3.274508e-01,3.378551e-01,
3.408488e-01,3.437282e-01,3.478551e-01,3.556810e-01,3.580981e-01,
3.604272e-01,3.626726e-01,3.689445e-01,3.736906e-01,3.864762e-01,
3.935745e-01,4.056471e-01,4.440497e-01,4.938044e-01,5.534364e-01,
6.130684e-01,6.727004e-01,7.522098e-01,8.515965e-01,9.509832e-01,
1.070247e+00,1.209389e+00,1.388285e+00,1.706322e+00,2.103869e+00,
2.456943e+00,2.608870e+00,2.770194e+00,2.941493e+00,3.123384e+00,
     3.383522e+00,3.451873e+00};

  static float y4[67] =
    {1.958e+00,2.109e+00,5.152e+00,7.860e+00,8.804e+00,
1.022e+01,1.242e+01,1.589e+01,2.826e+01,3.749e+01,
4.847e+01,6.061e+01,8.513e+01,9.578e+01,1.044e+02,
1.107e+02,1.154e+02,1.143e+02,1.114e+02,1.071e+02,
9.606e+01,7.850e+01,5.644e+01,4.594e+01,4.246e+01,
4.109e+01,3.769e+01,3.680e+01,3.774e+01,3.753e+01,
3.071e+01,2.279e+01,2.241e+01,2.212e+01,2.387e+01,
2.372e+01,2.299e+01,2.097e+01,1.580e+01,1.442e+01,
1.334e+01,1.258e+01,1.170e+01,1.188e+01,1.260e+01,
1.199e+01,1.030e+01,7.647e+00,5.617e+00,4.074e+00,
3.038e+00,2.328e+00,1.709e+00,1.222e+00,9.110e-01,
6.820e-01,5.284e-01,4.180e-01,3.077e-01,2.198e-01,
1.483e-01,1.239e-01,1.035e-01,8.645e-02,7.221e-02,
     5.648e-02,5.319e-02};

  static float x5[51] =
    {2.122199e-01,2.366491e-01,2.409057e-01,2.487117e-01,2.511230e-01,
2.534465e-01,2.567764e-01,2.701888e-01,2.834491e-01,2.915231e-01,
2.954636e-01,3.132096e-01,3.223921e-01,3.284800e-01,3.321330e-01,
3.369276e-01,3.483097e-01,3.535249e-01,3.559877e-01,3.595141e-01,
3.628520e-01,3.649790e-01,3.670318e-01,3.771374e-01,3.787826e-01,
3.926614e-01,4.016160e-01,4.075772e-01,4.431365e-01,5.127686e-01,
6.121553e-01,7.314193e-01,8.506834e-01,1.029579e+00,1.228353e+00,
1.506636e+00,1.804796e+00,2.222220e+00,2.407303e+00,2.556160e+00,
2.714227e+00,2.882065e+00,3.060281e+00,3.249517e+00,3.450456e+00,
3.663820e+00,3.890379e+00,4.130947e+00,4.386392e+00,4.565402e+00,
     4.657631e+00};

  static float y5[51] =
    {2.680e+01,2.114e+01,2.159e+01,2.585e+01,2.668e+01,
2.680e+01,2.590e+01,1.985e+01,1.956e+01,1.976e+01,
1.928e+01,1.486e+01,1.315e+01,1.268e+01,1.275e+01,
1.343e+01,1.862e+01,2.170e+01,2.280e+01,2.365e+01,
2.354e+01,2.302e+01,2.226e+01,1.710e+01,1.639e+01,
1.433e+01,1.448e+01,1.421e+01,1.187e+01,9.148e+00,
6.735e+00,4.881e+00,3.761e+00,2.769e+00,2.075e+00,
1.522e+00,1.147e+00,8.214e-01,6.562e-01,5.481e-01,
4.578e-01,3.824e-01,3.194e-01,2.668e-01,2.229e-01,
1.862e-01,1.555e-01,1.299e-01,1.085e-01,9.565e-02,
     9.008e-02};

  static float x6[85] =
    {1.482033e-01,1.499500e-01,1.516629e-01,1.533429e-01,1.549909e-01,
1.566076e-01,1.582033e-01,1.599422e-01,1.616449e-01,1.649461e-01,
1.681142e-01,1.711565e-01,1.740794e-01,1.754980e-01,1.768891e-01,
1.782533e-01,1.795914e-01,1.821917e-01,1.834552e-01,1.846951e-01,
1.859120e-01,1.871063e-01,1.882788e-01,1.894298e-01,1.905600e-01,
1.916698e-01,1.938303e-01,1.948819e-01,1.959149e-01,1.969299e-01,
1.979273e-01,1.989073e-01,2.008173e-01,2.035625e-01,2.061722e-01,
2.086553e-01,2.110198e-01,2.132732e-01,2.154222e-01,2.174734e-01,
2.275065e-01,2.349816e-01,2.370090e-01,2.392766e-01,2.417161e-01,
2.496819e-01,2.510867e-01,2.532377e-01,2.553613e-01,2.567658e-01,
2.586796e-01,2.598411e-01,2.629783e-01,2.653322e-01,2.729253e-01,
2.787985e-01,2.856346e-01,2.931683e-01,2.999084e-01,3.040147e-01,
3.249198e-01,3.292340e-01,3.331274e-01,3.611756e-01,3.791199e-01,
3.891199e-01,4.089972e-01,4.288746e-01,4.487519e-01,4.686293e-01,
4.885066e-01,5.083840e-01,5.282613e-01,5.680160e-01,6.077707e-01,
6.475253e-01,6.872800e-01,7.270347e-01,7.866667e-01,8.860534e-01,
     1.204091e+00,1.363110e+00,1.542006e+00,2.138326e+00,2.158203e+00};

  static float y6[85] = 
    {9.964e-05,1.830e-03,2.545e-02,3.979e-02,5.856e-02,
8.210e-02,1.109e-01,1.494e-01,1.955e-01,3.164e-01,
5.047e-01,8.916e-01,1.891e+00,2.851e+00,4.247e+00,
6.123e+00,8.437e+00,1.371e+01,1.615e+01,1.811e+01,
1.936e+01,1.981e+01,1.946e+01,1.841e+01,1.683e+01,
1.491e+01,1.080e+01,8.880e+00,7.174e+00,5.719e+00,
4.527e+00,3.587e+00,2.374e+00,1.907e+00,2.988e+00,
6.365e+00,1.342e+01,2.533e+01,4.210e+01,6.223e+01,
1.698e+02,2.717e+02,2.854e+02,2.822e+02,2.569e+02,
1.124e+02,9.185e+01,6.692e+01,4.935e+01,4.089e+01,
3.247e+01,2.869e+01,2.192e+01,1.898e+01,1.551e+01,
1.498e+01,1.381e+01,1.164e+01,9.556e+00,8.531e+00,
5.225e+00,4.683e+00,4.315e+00,2.563e+00,1.861e+00,
1.574e+00,1.148e+00,8.568e-01,6.570e-01,5.169e-01,
4.158e-01,3.406e-01,2.836e-01,2.020e-01,1.474e-01,
1.112e-01,8.757e-02,7.257e-02,5.958e-02,4.881e-02,
     2.846e-02,2.213e-02,1.866e-02,1.390e-02,1.368e-02};

  static float x7[90] =
    {1.311027e-01,1.328493e-01,1.345622e-01,1.362422e-01,1.378902e-01,
1.395069e-01,1.411027e-01,1.428415e-01,1.445443e-01,1.462119e-01,
1.478454e-01,1.494457e-01,1.510136e-01,1.525500e-01,1.540558e-01,
1.569787e-01,1.624908e-01,1.700057e-01,1.798293e-01,1.818067e-01,
1.855623e-01,1.864618e-01,1.873463e-01,1.882161e-01,1.890715e-01,
1.899129e-01,1.907405e-01,1.915546e-01,1.961725e-01,2.010357e-01,
2.016886e-01,2.023318e-01,2.029653e-01,2.048099e-01,2.082637e-01,
2.098816e-01,2.114323e-01,2.182971e-01,2.195133e-01,2.210637e-01,
2.221760e-01,2.246154e-01,2.271610e-01,2.320923e-01,2.353036e-01,
2.378919e-01,2.415789e-01,2.434244e-01,2.477566e-01,2.522298e-01,
2.558247e-01,2.630965e-01,2.698499e-01,2.760677e-01,2.817347e-01,
2.848972e-01,2.859145e-01,2.888617e-01,2.907433e-01,2.992576e-01,
3.007993e-01,3.022925e-01,3.037392e-01,3.071650e-01,3.127139e-01,
3.268456e-01,3.431190e-01,3.620193e-01,3.720193e-01,3.918966e-01,
4.117739e-01,4.316513e-01,4.515286e-01,4.714060e-01,4.912833e-01,
5.111606e-01,5.310380e-01,5.707927e-01,6.105474e-01,6.503020e-01,
6.900567e-01,7.298114e-01,7.695661e-01,8.093208e-01,8.490755e-01,
     9.087075e-01,9.683395e-01,1.047849e+00,1.147236e+00,1.286377e+00};

  static float y7[90] =
   {1.714e+01,1.231e+01,6.012e+00,5.426e+00,4.450e+00,
3.384e+00,2.417e+00,1.581e+00,1.016e+00,6.926e-01,
5.642e-01,5.880e-01,7.287e-01,9.589e-01,1.258e+00,
2.003e+00,3.837e+00,6.901e+00,8.965e+00,8.393e+00,
6.816e+00,6.500e+00,6.265e+00,6.128e+00,6.098e+00,
6.178e+00,6.369e+00,6.663e+00,1.015e+01,1.830e+01,
2.020e+01,2.239e+01,2.492e+01,3.495e+01,6.845e+01,
9.212e+01,1.195e+02,2.654e+02,2.868e+02,3.079e+02,
3.178e+02,3.221e+02,3.020e+02,2.199e+02,1.627e+02,
1.245e+02,8.495e+01,7.094e+01,4.885e+01,3.598e+01,
2.955e+01,2.179e+01,1.869e+01,1.922e+01,2.130e+01,
2.193e+01,2.193e+01,2.121e+01,2.022e+01,1.333e+01,
1.219e+01,1.122e+01,1.042e+01,9.083e+00,8.178e+00,
7.260e+00,5.535e+00,4.231e+00,3.695e+00,2.848e+00,
2.213e+00,1.737e+00,1.378e+00,1.104e+00,8.928e-01,
7.286e-01,6.006e-01,4.140e-01,2.878e-01,2.021e-01,
1.438e-01,1.042e-01,7.743e-02,5.926e-02,4.697e-02,
  3.518e-02,2.803e-02,2.247e-02,1.846e-02,1.622e-02};

  static float x8[80] =
    {1.034182e-01,1.051649e-01,1.068778e-01,1.085578e-01,1.118225e-01,
1.134182e-01,1.168599e-01,1.217612e-01,1.307129e-01,1.321040e-01,
1.374066e-01,1.386701e-01,1.423212e-01,1.541222e-01,1.605317e-01,
1.630561e-01,1.684881e-01,1.699320e-01,1.706371e-01,1.720151e-01,
1.740042e-01,1.765197e-01,1.805792e-01,1.816655e-01,1.832382e-01,
1.871247e-01,1.959112e-01,2.015154e-01,2.086556e-01,2.118111e-01,
2.128047e-01,2.134362e-01,2.143401e-01,2.149154e-01,2.165215e-01,
2.173826e-01,2.191675e-01,2.196783e-01,2.221910e-01,2.296517e-01,
2.311339e-01,2.325876e-01,2.340134e-01,2.354121e-01,2.367844e-01,
2.381402e-01,2.395080e-01,2.459661e-01,2.483832e-01,2.507124e-01,
2.518453e-01,2.529577e-01,2.551233e-01,2.582300e-01,2.621261e-01,
2.666353e-01,2.723502e-01,2.760548e-01,2.788164e-01,3.059495e-01,
3.200810e-01,3.343348e-01,3.642122e-01,3.840895e-01,4.238442e-01,
4.635989e-01,5.033535e-01,5.629856e-01,6.226176e-01,7.021270e-01,
7.816363e-01,8.810230e-01,1.020164e+00,1.159306e+00,1.298447e+00,
     1.477343e+00,1.676117e+00,1.954399e+00,2.199667e+00,2.244102e+00};

  static float y8[80] =
    {2.851e+01,1.004e+01,7.384e+00,7.645e+00,9.538e+00,
1.095e+01,1.378e+01,1.605e+01,1.654e+01,1.687e+01,
1.927e+01,1.962e+01,1.962e+01,1.823e+01,1.764e+01,
1.615e+01,1.099e+01,9.956e+00,9.589e+00,9.154e+00,
9.149e+00,9.875e+00,1.132e+01,1.155e+01,1.172e+01,
1.136e+01,8.884e+00,8.710e+00,1.016e+01,1.208e+01,
1.325e+01,1.423e+01,1.607e+01,1.757e+01,2.352e+01,
2.808e+01,4.151e+01,4.650e+01,7.956e+01,2.311e+02,
2.554e+02,2.722e+02,2.809e+02,2.818e+02,2.759e+02,
2.645e+02,2.488e+02,1.572e+02,1.270e+02,1.023e+02,
9.173e+01,8.231e+01,6.640e+01,4.859e+01,3.324e+01,
2.253e+01,1.553e+01,1.322e+01,1.218e+01,7.590e+00,
6.231e+00,5.261e+00,3.877e+00,3.236e+00,2.351e+00,
1.774e+00,1.392e+00,1.020e+00,7.795e-01,5.718e-01,
4.375e-01,3.284e-01,2.291e-01,1.637e-01,1.226e-01,
     9.051e-02,6.875e-02,5.133e-02,3.879e-02,3.653e-02};

  static float x9[83] =
    {9.909815e-02,1.008448e-01,1.025577e-01,1.042377e-01,1.090982e-01,
1.125398e-01,1.220513e-01,1.263929e-01,1.291482e-01,1.304863e-01,
1.330866e-01,1.343501e-01,1.368068e-01,1.414549e-01,1.498022e-01,
1.517122e-01,1.526428e-01,1.553418e-01,1.595501e-01,1.611392e-01,
1.626778e-01,1.641680e-01,1.663171e-01,1.721997e-01,1.799304e-01,
1.871087e-01,1.901715e-01,1.915912e-01,1.942303e-01,1.998393e-01,
2.015234e-01,2.039274e-01,2.051272e-01,2.062562e-01,2.088034e-01,
2.103103e-01,2.120740e-01,2.135317e-01,2.146372e-01,2.173776e-01,
2.238202e-01,2.253317e-01,2.268139e-01,2.282675e-01,2.296933e-01,
2.324643e-01,2.404031e-01,2.452385e-01,2.475252e-01,2.497302e-01,
2.549096e-01,2.623153e-01,2.664634e-01,2.702880e-01,2.738218e-01,
2.758147e-01,2.777189e-01,2.801288e-01,2.845473e-01,2.889578e-01,
2.966978e-01,3.062648e-01,3.159110e-01,3.300148e-01,3.598921e-01,
3.797695e-01,4.195241e-01,4.592788e-01,4.990335e-01,5.586655e-01,
6.381749e-01,7.176843e-01,7.971936e-01,8.965803e-01,1.055599e+00,
1.214618e+00,1.413391e+00,1.691674e+00,2.109098e+00,2.284759e+00,
     2.426039e+00,2.628098e+00,2.681189e+00};

  static float y9[83] =
    {1.342e+01,6.552e+00,7.578e+00,9.511e+00,1.687e+01,
2.172e+01,2.997e+01,2.524e+01,1.859e+01,1.576e+01,
1.259e+01,1.218e+01,1.264e+01,1.448e+01,1.500e+01,
1.447e+01,1.411e+01,1.265e+01,9.829e+00,8.965e+00,
8.382e+00,8.073e+00,8.002e+00,8.626e+00,9.042e+00,
1.060e+01,1.063e+01,1.031e+01,9.326e+00,7.456e+00,
7.345e+00,7.677e+00,8.088e+00,8.659e+00,1.087e+01,
1.305e+01,1.684e+01,2.124e+01,2.546e+01,3.938e+01,
8.320e+01,9.258e+01,1.005e+02,1.067e+02,1.113e+02,
1.164e+02,1.181e+02,1.170e+02,1.145e+02,1.101e+02,
9.203e+01,5.835e+01,4.230e+01,3.112e+01,2.394e+01,
2.111e+01,1.914e+01,1.752e+01,1.631e+01,1.597e+01,
1.458e+01,1.218e+01,1.064e+01,9.054e+00,6.689e+00,
5.598e+00,4.098e+00,3.121e+00,2.474e+00,1.845e+00,
1.325e+00,9.911e-01,7.725e-01,6.013e-01,4.364e-01,
3.297e-01,2.514e-01,1.867e-01,1.312e-01,1.048e-01,
     8.757e-02,6.848e-02,6.449e-02};

  static float x10[86] =
    {8.997667e-02,9.343618e-02,9.676421e-02,1.017155e-01,1.098876e-01,
1.172713e-01,1.213647e-01,1.252286e-01,1.276853e-01,1.300521e-01,
1.323334e-01,1.334432e-01,1.345331e-01,1.376883e-01,1.387033e-01,
1.397006e-01,1.406807e-01,1.416439e-01,1.435213e-01,1.462203e-01,
1.496145e-01,1.564904e-01,1.618393e-01,1.654485e-01,1.671377e-01,
1.682240e-01,1.741397e-01,1.763334e-01,1.787824e-01,1.831536e-01,
1.857299e-01,1.933085e-01,2.007514e-01,2.018917e-01,2.044101e-01,
2.067271e-01,2.090660e-01,2.123405e-01,2.146986e-01,2.176923e-01,
2.233428e-01,2.260664e-01,2.372708e-01,2.395162e-01,2.427357e-01,
2.447885e-01,2.477357e-01,2.557234e-01,2.581316e-01,2.596732e-01,
2.626132e-01,2.640154e-01,2.660390e-01,2.679722e-01,2.704181e-01,
2.721601e-01,2.732800e-01,2.743682e-01,2.754258e-01,2.774539e-01,
2.816294e-01,2.968945e-01,3.011924e-01,3.208932e-01,3.308932e-01,
3.507706e-01,3.706479e-01,4.302800e-01,5.495440e-01,6.886854e-01,
9.272135e-01,1.185619e+00,1.563288e+00,1.940958e+00,2.320833e+00,
2.464344e+00,2.616731e+00,2.778541e+00,2.950356e+00,3.132797e+00,
3.326518e+00,3.532219e+00,3.750638e+00,3.982564e+00,4.228833e+00,
     4.314260e+00};

  static float y10[86] =
    {5.133e+00,4.709e+00,5.000e+00,5.891e+00,8.346e+00,
1.185e+01,1.515e+01,2.036e+01,2.446e+01,2.713e+01,
2.634e+01,2.450e+01,2.192e+01,1.280e+01,1.021e+01,
8.119e+00,6.549e+00,5.472e+00,4.506e+00,4.835e+00,
6.413e+00,1.123e+01,1.625e+01,1.904e+01,1.982e+01,
2.009e+01,2.069e+01,2.197e+01,2.443e+01,2.858e+01,
2.895e+01,2.486e+01,2.402e+01,2.444e+01,2.666e+01,
3.120e+01,3.926e+01,5.730e+01,7.442e+01,9.812e+01,
1.341e+02,1.434e+02,1.579e+02,1.588e+02,1.546e+02,
1.474e+02,1.307e+02,7.101e+01,5.553e+01,4.702e+01,
3.383e+01,2.886e+01,2.299e+01,1.865e+01,1.465e+01,
1.262e+01,1.161e+01,1.081e+01,1.018e+01,9.277e+00,
8.169e+00,5.370e+00,4.818e+00,3.404e+00,3.019e+00,
2.537e+00,2.258e+00,1.840e+00,1.402e+00,1.104e+00,
8.046e-01,5.940e-01,4.105e-01,2.948e-01,1.903e-01,
1.589e-01,1.328e-01,1.109e-01,9.263e-02,7.737e-02,
6.463e-02,5.398e-02,4.509e-02,3.766e-02,3.128e-02,
     2.945e-02};

  static float x11[127] =
    {8.976763e-02,9.322721e-02,9.655523e-02,9.976768e-02,1.032093e-01,
1.065104e-01,1.081107e-01,1.096786e-01,1.112150e-01,1.127208e-01,
1.141968e-01,1.156437e-01,1.170624e-01,1.184534e-01,1.198177e-01,
1.211558e-01,1.224683e-01,1.237561e-01,1.262595e-01,1.274763e-01,
1.286707e-01,1.298431e-01,1.309942e-01,1.321244e-01,1.343241e-01,
1.353947e-01,1.364462e-01,1.374793e-01,1.384943e-01,1.394916e-01,
1.404717e-01,1.414349e-01,1.423817e-01,1.433123e-01,1.442273e-01,
1.451268e-01,1.460113e-01,1.468811e-01,1.477365e-01,1.485779e-01,
1.494055e-01,1.502196e-01,1.510206e-01,1.518087e-01,1.525842e-01,
1.533473e-01,1.540983e-01,1.548375e-01,1.555651e-01,1.569866e-01,
1.576809e-01,1.583645e-01,1.590377e-01,1.622543e-01,1.634749e-01,
1.646599e-01,1.658108e-01,1.695877e-01,1.705999e-01,1.715844e-01,
1.725421e-01,1.739307e-01,1.769621e-01,1.781783e-01,1.793485e-01,
1.804749e-01,1.815596e-01,1.826047e-01,1.867201e-01,1.889583e-01,
1.900034e-01,1.907573e-01,1.914868e-01,1.921929e-01,1.928765e-01,
1.937547e-01,1.943896e-01,1.956018e-01,1.972872e-01,1.981606e-01,
2.000926e-01,2.016827e-01,2.044298e-01,2.048756e-01,2.062263e-01,
2.071725e-01,2.091644e-01,2.131105e-01,2.144897e-01,2.231338e-01,
2.271990e-01,2.310726e-01,2.381947e-01,2.403997e-01,2.445795e-01,
2.484756e-01,2.503252e-01,2.521131e-01,2.529848e-01,2.546851e-01,
2.571329e-01,2.586996e-01,2.644913e-01,2.664842e-01,2.677632e-01,
2.696112e-01,2.725151e-01,2.757345e-01,2.831206e-01,2.870052e-01,
3.704389e-01,4.300710e-01,4.897030e-01,5.692124e-01,6.487217e-01,
7.282311e-01,8.077405e-01,9.071272e-01,1.006514e+00,1.105901e+00,
1.205287e+00,1.324551e+00,1.463693e+00,1.642589e+00,1.841362e+00,
     2.079890e+00,2.099768e+00};

  static float y11[127] =
    {2.726e-02,3.613e-02,4.979e-02,6.707e-02,9.381e-02,
1.333e-01,1.607e-01,1.957e-01,2.417e-01,3.045e-01,
3.969e-01,5.529e-01,8.646e-01,1.552e+00,3.035e+00,
5.910e+00,1.073e+01,1.763e+01,3.426e+01,4.087e+01,
4.439e+01,4.426e+01,4.086e+01,3.521e+01,2.193e+01,
1.609e+01,1.135e+01,7.757e+00,5.179e+00,3.405e+00,
2.226e+00,1.459e+00,9.695e-01,6.589e-01,4.634e-01,
3.440e-01,2.792e-01,2.612e-01,2.927e-01,3.849e-01,
5.568e-01,8.339e-01,1.248e+00,1.834e+00,2.631e+00,
3.681e+00,5.022e+00,6.692e+00,8.721e+00,1.392e+01,
1.709e+01,2.060e+01,2.439e+01,4.437e+01,5.083e+01,
5.542e+01,5.803e+01,5.976e+01,6.157e+01,6.510e+01,
7.044e+01,8.120e+01,1.081e+02,1.151e+02,1.177e+02,
1.158e+02,1.101e+02,1.015e+02,5.599e+01,3.541e+01,
2.824e+01,2.402e+01,2.065e+01,1.798e+01,1.588e+01,
1.380e+01,1.264e+01,1.109e+01,9.968e+00,9.733e+00,
9.883e+00,1.073e+01,1.434e+01,1.526e+01,1.878e+01,
2.195e+01,3.065e+01,5.487e+01,6.449e+01,1.056e+02,
1.033e+02,9.040e+01,5.758e+01,4.867e+01,3.623e+01,
3.054e+01,2.977e+01,3.010e+01,3.062e+01,3.230e+01,
3.612e+01,3.934e+01,5.353e+01,5.766e+01,5.965e+01,
6.135e+01,6.103e+01,5.716e+01,4.623e+01,4.417e+01,
2.835e+01,2.027e+01,1.513e+01,1.057e+01,7.434e+00,
5.307e+00,3.889e+00,2.722e+00,1.945e+00,1.417e+00,
1.061e+00,7.845e-01,5.835e-01,4.232e-01,3.130e-01,
     2.296e-01,2.245e-01};

  static float x12[100] =
    {8.911526e-02,9.911525e-02,1.074583e-01,1.120684e-01,1.149913e-01,
1.164100e-01,1.178011e-01,1.191653e-01,1.205034e-01,1.218160e-01,
1.231037e-01,1.256071e-01,1.268239e-01,1.280183e-01,1.291907e-01,
1.303418e-01,1.314720e-01,1.336717e-01,1.541851e-01,1.570285e-01,
1.597013e-01,1.616020e-01,1.668233e-01,1.678942e-01,1.694449e-01,
1.728217e-01,1.771258e-01,1.794518e-01,1.801886e-01,1.809072e-01,
1.822923e-01,1.839313e-01,1.869312e-01,1.903508e-01,1.926679e-01,
1.939445e-01,1.959045e-01,1.981769e-01,1.994402e-01,2.014371e-01,
2.035488e-01,2.053754e-01,2.067006e-01,2.082047e-01,2.094505e-01,
2.123607e-01,2.138373e-01,2.182846e-01,2.224814e-01,2.265466e-01,
2.291535e-01,2.304202e-01,2.316632e-01,2.328830e-01,2.340803e-01,
2.352556e-01,2.364095e-01,2.386548e-01,2.408203e-01,2.478232e-01,
2.496728e-01,2.514607e-01,2.523324e-01,2.540327e-01,2.556779e-01,
2.572702e-01,2.595644e-01,2.617518e-01,2.645134e-01,2.695567e-01,
2.712988e-01,2.729666e-01,2.735068e-01,2.760961e-01,2.789749e-01,
2.942117e-01,3.007354e-01,3.200319e-01,3.300319e-01,3.499092e-01,
3.697866e-01,4.095412e-01,4.890506e-01,6.083147e-01,7.474561e-01,
9.859842e-01,1.184758e+00,1.463040e+00,1.761200e+00,2.099115e+00,
2.273945e+00,2.414556e+00,2.563866e+00,2.722405e+00,2.890749e+00,
     3.069503e+00,3.259310e+00,3.460855e+00,3.749100e+00,3.824837e+00};

  static float y12[100] =
    {3.305e+00,4.668e+00,6.525e+00,8.681e+00,1.225e+01,
1.499e+01,1.793e+01,2.031e+01,2.138e+01,2.077e+01,
1.872e+01,1.289e+01,1.035e+01,8.474e+00,7.225e+00,
6.466e+00,6.031e+00,5.667e+00,8.265e+00,9.078e+00,
9.607e+00,9.715e+00,9.008e+00,8.928e+00,9.151e+00,
1.233e+01,2.329e+01,2.990e+01,3.152e+01,3.276e+01,
3.401e+01,3.349e+01,2.823e+01,2.058e+01,1.692e+01,
1.564e+01,1.460e+01,1.455e+01,1.502e+01,1.654e+01,
1.943e+01,2.330e+01,2.705e+01,3.238e+01,3.769e+01,
5.321e+01,6.267e+01,9.790e+01,1.420e+02,1.930e+02,
2.238e+02,2.361e+02,2.455e+02,2.516e+02,2.543e+02,
2.535e+02,2.495e+02,2.338e+02,2.110e+02,1.258e+02,
1.068e+02,9.081e+01,8.377e+01,7.137e+01,6.087e+01,
5.195e+01,4.095e+01,3.230e+01,2.371e+01,1.383e+01,
1.184e+01,1.045e+01,1.009e+01,8.848e+00,8.075e+00,
5.477e+00,4.627e+00,3.303e+00,2.918e+00,2.427e+00,
2.133e+00,1.794e+00,1.403e+00,1.041e+00,7.955e-01,
5.458e-01,4.118e-01,2.998e-01,2.264e-01,1.689e-01,
1.349e-01,1.127e-01,9.412e-02,7.861e-02,6.566e-02,
     5.485e-02,4.581e-02,3.827e-02,2.993e-02,2.818e-02};

  static float x13[90] =
    {8.796370e-02,8.971035e-02,9.142327e-02,9.310329e-02,9.475124e-02,
9.636801e-02,9.796369e-02,9.970260e-02,1.014053e-01,1.030730e-01,
1.063067e-01,1.109169e-01,1.152584e-01,1.166495e-01,1.180137e-01,
1.193518e-01,1.206644e-01,1.219521e-01,1.232156e-01,1.244555e-01,
1.268667e-01,1.280392e-01,1.303204e-01,1.335907e-01,1.386677e-01,
1.424233e-01,1.450772e-01,1.484157e-01,1.492167e-01,1.500047e-01,
1.507802e-01,1.515433e-01,1.530336e-01,1.537612e-01,1.551826e-01,
1.572338e-01,1.591928e-01,1.622678e-01,1.640068e-01,1.662110e-01,
1.677837e-01,1.702626e-01,1.738933e-01,1.775446e-01,1.804567e-01,
1.824598e-01,1.868856e-01,1.939927e-01,1.968606e-01,1.988856e-01,
2.016873e-01,2.035028e-01,2.080196e-01,2.126857e-01,2.156794e-01,
2.185589e-01,2.213299e-01,2.253950e-01,2.396688e-01,2.511808e-01,
2.561186e-01,2.584129e-01,2.613068e-01,2.659592e-01,2.718151e-01,
2.734129e-01,2.791771e-01,2.927880e-01,3.188803e-01,3.686350e-01,
4.680217e-01,5.872857e-01,7.264271e-01,8.456912e-01,1.024587e+00,
1.203483e+00,1.422134e+00,1.700417e+00,2.018454e+00,2.272697e+00,
2.413232e+00,2.562460e+00,2.720913e+00,2.889164e+00,3.067820e+00,
     3.257523e+00,3.458957e+00,3.672848e+00,3.822740e+00,3.899963e+00};

  static float y13[90] =
{7.539e+01,6.336e+01,3.906e+01,3.353e+01,2.634e+01,
2.010e+01,1.542e+01,1.182e+01,9.380e+00,7.682e+00,
5.519e+00,4.268e+00,1.471e+01,2.454e+01,3.658e+01,
4.800e+01,5.565e+01,5.756e+01,5.376e+01,4.598e+01,
2.744e+01,1.986e+01,1.028e+01,5.164e+00,3.818e+00,
4.543e+00,6.307e+00,9.407e+00,1.002e+01,1.047e+01,
1.076e+01,1.086e+01,1.057e+01,1.022e+01,9.256e+00,
7.612e+00,6.222e+00,4.868e+00,4.485e+00,4.231e+00,
4.166e+00,4.283e+00,4.962e+00,5.682e+00,5.756e+00,
5.551e+00,4.965e+00,4.675e+00,4.774e+00,5.045e+00,
5.914e+00,6.859e+00,1.029e+01,1.402e+01,1.572e+01,
1.667e+01,1.704e+01,1.693e+01,1.567e+01,1.781e+01,
1.999e+01,2.077e+01,2.114e+01,2.011e+01,1.758e+01,
1.706e+01,1.648e+01,1.725e+01,1.727e+01,1.614e+01,
1.203e+01,8.950e+00,6.307e+00,4.839e+00,3.503e+00,
2.622e+00,1.975e+00,1.447e+00,1.077e+00,7.943e-01,
6.636e-01,5.542e-01,4.629e-01,3.867e-01,3.230e-01,
 2.698e-01,2.253e-01,1.882e-01,1.660e-01,1.563e-01};


  static float xedge[13] = {0.4493089,0.31117994,0.25020038,0.23377325,
                           0.26399946,0.16189987,0.14569965,0.11626186,
                           0.1145858,0.1094219,0.09922249,0.10532202,
                           0.12370905};

  static int jp[16] = {5,5,5,5,5,5,5,5,5,5,
                       5,5,5,5,5,5};

  Ryd = nu/3.2898419499e+15;
  tkev = 8.617e-05*model->T[k];
  u = partfn(20.0,model->T[k],model->Ne[k]);

  xsect = 0.0;

  /* 1 3p6.4s2 1S Ground State */

  if(Ryd >= xedge[0]) {
    ryd = Ryd+x1[0]-xedge[0];
    search(x1-1,52,ryd,&jp[0]);
    j = jp[0];
    xsect += 1.0*(y1[j-1] + (y1[j]-y1[j-1])*(ryd-x1[j-1])/
                         (x1[j]-x1[j-1]));
  }

  /* 2 3p6.4s.4p 3P*  */

  if(Ryd >= xedge[1]) {
    ryd = Ryd+x2[0]-xedge[1];
    search(x2-1,38,ryd,&jp[1]);
    j = jp[1];
    xsect +=  (y2[j-1] + (y2[j]-y2[j-1])*(ryd-x2[j-1])/
              (x2[j]-x2[j-1]))*9.0*exp(-1.8793401/tkev);
  }

  /* 3 3p6.3d.4s 1D  */

  if(Ryd >= xedge[2]) {
    ryd = Ryd+x3[0]-xedge[2];
    search(x3-1,47,ryd,&jp[2]);
    j = jp[2];
    xsect +=  (y3[j-1] + (y3[j]-y3[j-1])*(ryd-x3[j-1])/
              (x3[j]-x3[j-1]))*5.0*exp(-2.7090092/tkev);
  } 

  /* 4 3p6.4s.4p 1P* */

  if(Ryd >= xedge[3]) {
    ryd = Ryd+x4[0]-xedge[3];
    search(x4-1,67,ryd,&jp[3]);
    j = jp[3];
    xsect +=  (y4[j-1] + (y4[j]-y4[j-1])*(ryd-x4[j-1])/
              (x4[j]-x4[j-1]))*3.0*exp(-2.9325118/tkev);
  }

  /* 5 3p6.3d.4s  3D */

  if(Ryd >= xedge[4]) {
    ryd = Ryd+x5[0]-xedge[4];
    search(x5-1,51,ryd,&jp[4]);
    j = jp[4];
    xsect +=  (y5[j-1] + (y5[j]-y5[j-1])*(ryd-x5[j-1])/
              (x5[j]-x5[j-1]))*15.0*exp(-2.5212631/tkev);
  }

  /* 6 3p6.4s.5s  3S */

  if(Ryd >= xedge[5]) {
    ryd = Ryd+x6[0]-xedge[5];
    search(x6-1,85,ryd,&jp[5]);
    j = jp[5];
    xsect +=  (y6[j-1] + (y6[j]-y6[j-1])*(ryd-x6[j-1])/
              (x6[j]-x6[j-1]))*3.0*exp(-3.9103988/tkev);
  } 

  /* 7 3p6.4s.5s 1S */

  if(Ryd >= xedge[6]) {
    ryd = Ryd+x7[0]-xedge[6];
    search(x7-1,90,ryd,&jp[6]);
    j = jp[6];
    xsect +=  (y7[j-1] + (y7[j]-y7[j-1])*(ryd-x7[j-1])/
              (x7[j]-x7[j-1]))*1.0*exp(-4.1308140/tkev);
  }

  /* 8 3p6.4s.5p  3P* */

  if(Ryd >= xedge[7]) {
    ryd = Ryd+x8[0]-xedge[7];
    search(x8-1,80,ryd,&jp[7]);
    j = jp[7];
    xsect +=  (y8[j-1] + (y8[j]-y8[j-1])*(ryd-x8[j-1])/
              (x8[j]-x8[j-1]))*9.0*exp(-4.5313355/tkev);
  }

  /* 9 3p6.4s.5p  1P*  */

  if(Ryd >= xedge[8]) {
    ryd = Ryd+x9[0]-xedge[8];
    search(x9-1,83,ryd,&jp[8]);
    j = jp[8];
    xsect +=  (y9[j-1] + (y9[j]-y9[j-1])*(ryd-x9[j-1])/
              (x9[j]-x9[j-1]))*3.0*exp(-4.5541396/tkev);
  } 

  /* 10 3p6.4s.4d  1D 4.6243979  */

  if(Ryd >= xedge[9]) {
    ryd = Ryd+x10[0]-xedge[9];
    search(x10-1,86,ryd,&jp[9]);
    j = jp[9];
    xsect +=  (y10[j-1] + (y10[j]-y10[j-1])*(ryd-x10[j-1])/
              (x10[j]-x10[j-1]))*5.0*exp(-4.6243979/tkev);
  }
    
  /* 11 3p6.4p2  3P */  

  if(Ryd >= xedge[10]) {
    ryd = Ryd+x11[0]-xedge[10];
    search(x11-1,127,ryd,&jp[10]);
    j = jp[10];
    xsect +=  (y11[j-1] + (y11[j]-y11[j-1])*(ryd-x11[j-1])/
              (x11[j]-x11[j-1]))*9.0*exp(-4.7631680/tkev);
  }

  /* 12 3p6.4s.4d  3D  4.6801796 */

  if(Ryd >= xedge[11]) {
    ryd = Ryd+x12[0]-xedge[11];
    search(x12-1,100,ryd,&jp[11]);
    j = jp[11];
    xsect +=  (y12[j-1] + (y12[j]-y12[j-1])*(ryd-x12[j-1])/
              (x12[j]-x12[j-1]))*5.0*exp(-4.6801796/tkev);
  }   

  /* 13 3p6.3d.4p  3F*  */

  if(Ryd >= xedge[12]) {
    ryd = Ryd+x13[0]-xedge[12];
    search(x13-1,90,ryd,&jp[12]);
    j = jp[12];
    xsect +=  (y13[j-1] + (y13[j]-y13[j-1])*(ryd-x13[j-1])/
              (x13[j]-x13[j-1]))*9.0*exp(-4.4300114/tkev);
  }  

  return(1.0e-18*model->stim[k]*xsect/u);
}
