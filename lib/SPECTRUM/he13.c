#include <stdio.h>
#include <math.h>
#include <errno.h>
#include "spectrum.h"

float he4471_13(T,wave)
double T,wave;
{
 double DL,p1,p2;
 int i,j,k;
 static int l = 0;
 static float dl[47] = {-5.00,-4.50,-4.00,-3.50,-3.00,-2.50,-2.00,-1.80,-1.60,
		 -1.50,-1.45,-1.40,-1.30,-1.20,-1.00,-0.80,-0.60,-0.40,
		 -0.30,-0.20,-0.15,-0.10,-0.06,-0.04,-0.02,0.00,0.02,0.04,
		 0.06,0.10,0.15,0.20,0.25,0.30,0.40,0.50,0.60,0.80,1.00,
		 1.50,2.00,2.50,3.00,3.50,4.00,4.50,5.00};
 static float t[4] = {5000.0,10000.0,20000.0,40000.0};
 static float b1[4] = {2.18e-14,2.09e-14,1.98e-14,1.86e-14};
 static float b2[4] = {1.50e-14,1.44e-14,1.35e-14,1.25e-14};
 static float prof[47][4] = {{3.48e-05,3.33e-05,3.15e-05,2.97e-05},
 {4.70e-05,4.44e-05,4.19e-05,3.93e-05},{6.52e-05,6.13e-05,5.74e-05,5.38e-05},
 {9.37e-05,8.79e-05,8.24e-05,7.73e-05},{1.42e-04,1.34e-04,1.26e-04,1.18e-04},
 {2.39e-04,2.26e-04,2.14e-04,2.07e-04},{5.22e-04,5.10e-04,4.94e-04,4.77e-04},
 {7.99e-04,7.74e-04,7.42e-04,7.17e-04},{1.56e-03,1.50e-03,1.39e-03,1.23e-03},
 {2.99e-03,2.46e-03,1.92e-03,1.52e-03},{3.63e-03,2.77e-03,2.06e-03,1.60e-03},
 {3.21e-03,2.65e-03,2.04e-03,1.62e-03},{1.78e-03,1.83e-03,1.66e-03,1.50e-03},
 {1.27e-03,1.32e-03,1.27e-03,1.29e-03},{8.05e-04,8.80e-04,9.37e-04,10.15e-04},
 {9.35e-04,9.41e-04,9.92e-04,10.61e-04},{1.51e-03,1.43e-03,1.49e-03,1.89e-03},
 {3.48e-03,3.48e-03,4.78e-03,43.13e-03},{6.52e-03,7.58e-03,41.98e-03,254.73e-03},
 {2.00e-02,10.64e-02,48.43e-02,93.98e-02},{1.17e-01,5.64e-01,11.90e-01,14.89e-01},
 {1.09e+00,1.97e+00,2.26e+00,2.07e+00},{3.78e+00,3.73e+00,3.13e+00,2.46e+00},
 {5.54e+00,4.53e+00,3.46e+00,2.60e+00},{6.87e+00,5.06e+00,3.68e+00,2.69e+00},
 {7.22e+00,5.19e+00,3.74e+00,2.73e+00},{6.43e+00,4.91e+00,3.66e+00,2.72e+00},
 {4.85e+00,4.28e+00,3.45e+00,2.65e+00},{3.12e+00,3.46e+00,3.14e+00,2.54e+00},
 {9.21e-01,19.03e-01,23.56e-01,22.15e-01},{6.38e-01,9.50e-01,14.61e-01,17.00e-01},
 {9.27e-01,7.32e-01,8.76e-01,11.93e-01},{5.38e-01,5.12e-01,5.32e-01,7.78e-01},
 {1.20e-01,2.31e-01,3.04e-01,4.77e-01},{6.91e-03,15.58e-03,60.12e-03,149.52e-03},
 {3.71e-03,3.67e-03,7.30e-03,35.46e-03},{2.47e-03,2.35e-03,2.40e-03,6.92e-03},
 {1.26e-03,1.20e-03,1.16e-03,1.18e-03},{8.63e-04,8.04e-04,7.58e-04,7.44e-04},
 {3.62e-04,3.42e-04,3.19e-04,2.97e-04},{1.94e-04,1.84e-04,1.72e-04,1.59e-04},
 {11.70e-05,11.20e-05,10.50e-05,9.74e-05},{7.76e-05,7.40e-05,6.96e-05,6.47e-05},
 {5.47e-05,5.24e-05,4.92e-05,4.56e-05},{4.02e-05,3.86e-05,3.62e-05,3.37e-05},
 {3.06e-05,2.93e-05,2.75e-05,2.54e-05},{2.41e-05,2.31e-05,2.17e-05,2.01e-05}};

 if(T <= 5000.0) T = 5000.1;
 if(T >= 40000.0) T = 39999.9;

 DL = wave - 4471.48;

 for(i=0;i<3;i++) {
   if(T >= t[i] && T < t[i+1]) {
     k = i;
     break;
   }
 }

 if(DL <= -5.00) {
   p1 = b1[k]*pow(4471.48+DL,3.0)*pow(-DL,-2.5);
   p2 = b1[k+1]*pow(4471.48+DL,3.0)*pow(-DL,-2.5);
   return(p1 + (p2 - p1)*(T-t[k])/(t[k+1]-t[k]));
 }

 if(DL >= 5.00) {
   p1 = b2[k]*pow(4471.48+DL,3.0)*pow(DL,-2.5);
   p2 = b2[k+1]*pow(4471.48+DL,3.0)*pow(DL,-2.5);
   return(p1 + (p2 - p1)*(T-t[k])/(t[k+1]-t[k]));
 }

 for(j=l;j<46;j++) {
   if(DL > dl[j] && DL <= dl[j+1]) {
     l = j;
     break;
   }
 }

 p1 = prof[l][k] + (prof[l][k+1]-prof[l][k])*(T-t[k])/(t[k+1]-t[k]);
 p2 = prof[l+1][k] + (prof[l+1][k+1]-prof[l+1][k])*(T-t[k])/(t[k+1]-t[k]);
 return(p1 + (p2-p1)*(DL-dl[l])/(dl[l+1]-dl[l]));
}


float he4922_13(T,wave)
double T,wave;
{
 double DL,p1,p2;
 int i,j,k;
 static int l = 0;
 static float dl[48] = {-5.00,-4.00,-3.50,-3.00,-2.50,-2.00,-1.80,-1.60,
	    -1.50,-1.45,-1.40,-1.35,-1.30,-1.25,-1.20,-1.10,-1.00,-0.80,-0.60,
	    -0.40,-0.30,-0.20,-0.15,-0.10,-0.06,-0.04,-0.02, 0.00, 0.02,
	     0.04, 0.06, 0.10, 0.15, 0.20, 0.25, 0.30, 0.40, 0.50, 0.60,
	     0.80, 1.00, 1.20, 1.50, 2.00, 2.50, 3.00, 4.00, 5.00};
 static float t[4] = {5000.0,10000.0,20000.0,40000.0};
 static float b1[4] = {1.716e-14,1.533e-14,1.340e-14,1.166e-14};
 static float b2[4] = {1.982e-14,1.874e-14,1.753e-14,1.622e-14};
 static float prof[48][4] = {{3.65e-05,3.26e-05,2.85e-05,2.48e-05},
 {7.86e-05,7.11e-05,6.39e-05,5.74e-05},{11.57e-5,10.53e-5,9.55e-05,8.67e-05},
 {1.79e-04,1.64e-04,1.51e-04,1.38e-04},{3.04e-04,2.82e-04,2.62e-04,2.44e-04},
 {6.23e-04,5.99e-04,5.76e-04,5.51e-04},{9.67e-04,9.23e-04,8.74e-04,8.26e-04},
 {1.65e-03,1.55e-03,1.46e-03,1.33e-03},{2.45e-03,2.28e-03,2.04e-03,1.70e-03},
 {3.22e-03,2.85e-03,2.38e-03,1.87e-03},{4.28e-03,3.44e-03,2.66e-03,2.01e-03},
 {4.94e-03,3.74e-03,2.80e-03,2.09e-03},{4.42e-03,3.56e-03,2.76e-03,2.10e-03},
 {3.26e-03,3.02e-03,2.56e-03,2.06e-03},{2.36e-03,2.44e-03,2.28e-03,1.96e-03},
 {1.60e-03,1.74e-03,1.78e-03,1.74e-03},{1.38e-03,1.48e-03,1.54e-03,1.59e-03},
 {1.55e-03,1.55e-03,1.61e-03,1.73e-03},{2.54e-03,2.44e-03,2.57e-03,3.99e-03},
 {5.91e-03,5.99e-03,10.52e-3,86.67e-3},{1.13e-02,1.49e-02,8.85e-02,37.81e-2},
 {4.07e-02,20.26e-2,67.95e-2,111.07e-2},{2.27e-01,8.10e-01,14.28e-1,16.22e-1},
 {1.45,2.28,2.43,2.12,},{4.06,3.88,3.19,2.44},{5.60,4.57,3.47,2.54},
 {6.75,5.03,3.64,2.61},{7.11,5.17,3.69,2.62},{6.55,4.96,3.61,2.60},
 {5.27,4.44,3.42,2.53},{3.72,3.71,3.12,2.41},{1.27,2.12,2.35,2.09},
 {2.06e-01,7.32e-01,13.55e-1,15.83e-1},{4.72e-2,18.47e-2,63.61e-2,107.65e-2},
 {2.41e-02,4.58e-02,24.73e-2,65.76e-2},{1.58e-2,1.85e-2,8.38e-2,36.22e-2},
 {8.61e-3,8.48e-3,12.15e-3,83.22e-3},{5.43e-3,5.20e-3,5.33e-3,15.97e-3},
 {3.74e-3,3.53e-3,3.45e-3,4.62e-3},{2.06e-3,1.92e-3,1.83e-3,1.84e-3},
 {1.30e-3,1.20e-3,1.13e-3,1.07e-3},{9.16e-4,8.56e-4,8.00e-4,7.53e-4},
 {5.72e-4,5.36e-4,5.00e-4,4.69e-4},{3.09e-4,2.90e-4,2.69e-4,2.51e-4},
 {1.92e-4,1.80e-4,1.68e-4,1.55e-4},{1.30e-4,1.22e-4,1.13e-4,1.05e-4},
 {6.90e-5,6.52e-5,6.08e-5,5.63e-5},{4.24e-5,4.01e-5,3.75e-5,3.47e-5}};

 if(T <= 5000.0) T = 5000.1;
 if(T >= 40000.0) T = 39999.9;

 DL = wave - 4921.93;

 for(i=0;i<3;i++) {
   if(T >= t[i] && T < t[i+1]) {
     k = i;
     break;
   }
 }

 if(DL <= -5.00) {
   p1 = b1[k]*pow(4921.93+DL,3.0)*pow(-DL,-2.5);
   p2 = b1[k+1]*pow(4921.93+DL,3.0)*pow(-DL,-2.5);
   return(p1 + (p2 - p1)*(T-t[k])/(t[k+1]-t[k]));
 }

 if(DL >= 5.00) {
   p1 = b2[k]*pow(4921.93+DL,3.0)*pow(DL,-2.5);
   p2 = b2[k+1]*pow(4921.93+DL,3.0)*pow(DL,-2.5);
   return(p1 + (p2 - p1)*(T-t[k])/(t[k+1]-t[k]));
 }

 for(j=l;j<47;j++) {
   if(DL > dl[j] && DL <= dl[j+1]) {
     l = j;
     break;
   }
 }

 p1 = prof[l][k] + (prof[l][k+1]-prof[l][k])*(T-t[k])/(t[k+1]-t[k]);
 p2 = prof[l+1][k] + (prof[l+1][k+1]-prof[l+1][k])*(T-t[k])/(t[k+1]-t[k]);
 return(p1 + (p2-p1)*(DL-dl[l])/(dl[l+1]-dl[l]));

}


